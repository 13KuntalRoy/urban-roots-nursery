{
    admin off
}

:{$PORT} {
    # Static files from Django (handle_path strips the /static/ prefix)
    handle_path /static/* {
        root * /app/backend/staticfiles
        file_server
    }

    # Media files from Django
    handle /media/* {
        root * /app/backend
        file_server
    }

    # Proxy to Django Gunicorn
    handle /api/* {
        reverse_proxy localhost:8000
    }

    handle /admin/* {
        reverse_proxy localhost:8000
    }

    # Frontend React SPA
    handle {
        root * /srv
        file_server
        try_files {path} /index.html
    }
}
